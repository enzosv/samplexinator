<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quiz Attempt</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      .correct {
        color: green;
      }
      .incorrect {
        color: red;
      }
    </style>
  </head>
  <body class="container">
    <h2 class="text-center">Quiz Attempt</h2>
    <p id="attempt-info" class="fw-bold text-center"></p>
    <div id="attempt-container" class="mt-3"></div>
    <a href="history.html" class="btn btn-secondary mt-3">Back to History</a>

    <script>
      const urlParams = new URLSearchParams(window.location.search);
      const attemptIndex = urlParams.get("index");
      const storageKey = "quizHistory";
      const history = JSON.parse(localStorage.getItem(storageKey)) || [];

      if (attemptIndex === null || attemptIndex >= history.length) {
        document.getElementById("attempt-container").innerHTML =
          "<p class='text-danger'>Invalid attempt.</p>";
      } else {
        const attempt = history[attemptIndex];
        document.getElementById("attempt-info").innerText = `Attempt ${
          parseInt(attemptIndex) + 1
        } - Score: ${attempt.score.toFixed(2)}% (${new Date(
          attempt.timestamp
        ).toLocaleString()})`;

        const container = document.getElementById("attempt-container");
        attempt.questions.forEach((q, index) => {
          const div = document.createElement("div");
          div.className = "question border p-3 mb-3 rounded";
          div.innerHTML = `<p><strong>${q.question_text}</strong></p>`;

          for (const [key, value] of Object.entries(q.options)) {
            const isUserAnswer = attempt.answers[q.question_number] === key;
            const isCorrect = q.correct_answer === key;
            div.innerHTML += `
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="question-${
                              q.question_number
                            }" value="${key}" disabled ${
              isUserAnswer ? "checked" : ""
            }>
                            <label class="form-check-label ${
                              isCorrect
                                ? "correct"
                                : isUserAnswer
                                ? "incorrect"
                                : ""
                            }">
                                ${key}: ${value}
                            </label>
                        </div>
                    `;
          }

          div.innerHTML += `<p class="fw-bold ${
            attempt.answers[q.question_number] === q.correct_answer
              ? "text-success"
              : "text-danger"
          }">Your Answer: ${
            attempt.answers[q.question_number] || "No answer"
          } | Correct Answer: ${q.correct_answer}</p>`;
          container.appendChild(div);
        });
      }
    </script>
  </body>
</html>
